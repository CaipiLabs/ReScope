module.exports=function(t){function e(i){if(s[i])return s[i].exports;var r=s[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var s={};return e.m=t,e.c=s,e.p="/",e(0)}([function(t,e,s){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=s(3),n=i(r),a=s(5),o=i(a);n.default.Store=o.default,e.default={Store:o.default,Context:n.default,Scope:n.default},t.exports=e.default},function(t,e){t.exports=require("is")},function(t,e,s){"use strict";function i(t){if(Array.isArray(t)){for(var e=0,s=Array(t.length);e<t.length;e++)s[e]=t[e];return s}return Array.from(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}(),a=s(1),o=function(){function t(){r(this,t),this._events={}}return n(t,[{key:"on",value:function(t,e){var s=this;return!a.string(t)&&t?Object.keys(t).forEach(function(e){return s.on(e,t[e])}):(this._events[t]=this._events[t]||[],void this._events[t].push(e))}},{key:"un",value:function(t,e){var s=this;if(!a.string(t)&&t)return Object.keys(t).forEach(function(e){return s.un(e,t[e])});if(this._events[t]){var i=this._events[t].indexOf(e);this._events[t].splice(i,1)}}},{key:"emit",value:function(t){if(this._events[t]){for(var e=[].concat(i(this._events[t])),s=arguments.length,r=Array(s>1?s-1:0),n=1;n<s;n++)r[n-1]=arguments[n];for(var a=0;a<e.length;a++)e[a].apply(e,r)}}},{key:"addListener",value:function(){this.on.apply(this,arguments)}},{key:"removeListener",value:function(){this.un.apply(this,arguments)}},{key:"removeAllListeners",value:function(){this._events={}}},{key:"once",value:function(t,e){var s=this,i=void 0;this.on(t,i=function(){s.un(t,i),e.apply(void 0,arguments)})}}]),t}();e.default=o,t.exports=e.default},function(t,e,s){"use strict";function i(t){if(Array.isArray(t)){for(var e=0,s=Array(t.length);e<t.length;e++)s[e]=t[e];return s}return Array.from(t)}function r(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}(),l=s(1),h=s(2),c=s(4),_=function(t,e,s){var i=function(){};i.prototype=s?new s["_"+e]:t[e]||{},t[e]=new i,t["_"+e]=i},f={},p=function(t){function e(t){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=s.id,r=s.parent,o=s.state,u=s.data,l=(s.name,s.incrementId),h=s.defaultMaxListeners,p=s.persistenceTm,d=s.autoDestroy,v=s.rootEmitter;n(this,e);var y=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(y._maxListeners=h||y.constructor.defaultMaxListeners,i=i||"_____"+c.generate(),f[i]&&!l){var b;return y._id=i,f[i].register(t),b=f[i],a(y,b)}if(f[i]&&l){for(var m=-1;f[i+"/"+ ++m];);i=i+"/"+m}if(y._id=i,f[i]=y,y._isLocalId=!0,y._persistenceTm=p||y.constructor.persistenceTm,y.stores={},y.state={},y.data={},r&&r.dead)throw new Error("Can't use a dead scope as parent !");return _(y,"stores",r),_(y,"state",r),_(y,"data",r),y.parent=r,y.sources=[],y._childScopes=[],y._childScopesList=[],y._unStableChilds=0,y.__retains={all:0},y.__locks={all:1},y.__listening={},y.__scope={},y.__mixed=[],y.__mixedList=[],y._followers=[],r&&(r.retain("isMyParent"),v?r.on(y.__parentList={update:function(t){return y._propag()}}):(!r._stable&&y.wait("waitingParent"),r.on(y.__parentList={stable:function(t){return y.release("waitingParent")},unstable:function(t){return y.wait("waitingParent")},update:function(t){return y._propag()}}))),y.register(t,o,u),y.__locks.all--,y._stable=!y.__locks.all,r&&r._addChild(y),d&&setTimeout(function(t){y.retain("autoDestroy"),y.dispose("autoDestroy")}),y}return o(e,t),u(e,null,[{key:"getScope",value:function(t){var s=l.array(t)?t.sort(function(t,e){return t.firstname<e.firstname?-1:t.firstname>e.firstname?1:0}).join("::"):t;return f[s]=f[s]||new e({},{id:s})}}]),u(e,[{key:"mount",value:function(t,e,s){var i=this;return l.array(t)?t.forEach(function(t){return i._mount(t,e&&e[t],s&&s[t])}):this._mount.apply(this,arguments),this}},{key:"_mount",value:function(t,e,s){if("string"!=typeof t&&(this.register(r({},t.name,t.store)),t=t.name),!this.__scope[t]){var i;if(this.__mixed.reduce(function(i,r){return i||r._mount(t,e,s)},!1)||!this.parent)return;return(i=this.parent)._mount.apply(i,arguments)}var n=this.__scope[t];return l.fn(n)?this.__scope[t]=new n(this,{state:e,data:s}):(void 0!==e&&void 0===s?n.setState(e):void 0!==e&&(n.state=e),void 0!==s&&n.push(s)),this._watchStore(t),this.__scope[t]}},{key:"_watchStore",value:function(t,e,s){var i=this;if(!this.__scope[t]){var r;if(this.__mixed.reduce(function(i,r){return i||r._watchStore(t,e,s)},!1)||!this.parent)return;return(r=this.parent)._watchStore.apply(r,arguments)}return this.__listening[t]||l.fn(this.__scope[t])||(!this.__scope[t].isStable()&&this.wait(t),this.__scope[t].on(this.__listening[t]={destroy:function(e){delete i.__listening[t],i.__scope[t]=i.__scope[t].constructor},update:function(t){return i.propag()},stable:function(e){return i.release(t)},unstable:function(e){return i.wait(t)}})),!0}},{key:"mixin",value:function(t){var e=this,s=this.parent,i=void 0;this.__mixed.push(t),t.retain("mixedTo"),t._stable||this.wait(t._id),this.__mixedList.push(i={stable:function(s){return e.release(t._id)},unstable:function(s){return e.wait(t._id)},update:function(t){return e._propag()}}),this.stores={},this.state={},this.data={},t.on(i),_(this,"stores",s),_(this,"state",s),_(this,"data",s),this.relink(this.__scope,this,!1,!0),this.__mixed.forEach(function(t){_(e,"stores"),_(e,"state"),_(e,"data"),t.relink(t.__scope,e,!0,!0)})}},{key:"register",value:function(t){var e=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.relink(t,this,!1,!1),Object.keys(t).forEach(function(r){t[r].singleton||l.fn(t[r])&&(s[r]||i[r])?e._mount(r,s[r],i[r]):s[r]||i[r]?i[r]?(s[r]&&(e.stores[r].state=s[r]),e.stores[r].push(i[r])):s[r]&&e.stores[r].setState(s[r]):e._watchStore(r)})}},{key:"relink",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,s=this,i=arguments[2],r=arguments[3],n=e._stores.prototype;Object.keys(t).forEach(function(a){if(!(!r&&e.__scope[a]===t[a]||e.__scope[a]&&e.__scope[a].constructor===t[a])){if(!r&&e.__scope[a])return i||l.fn(e.__scope[a])||(e.__scope[a].__proto__=t[a].prototype),void(!i&&l.fn(e.__scope[a])&&(e.__scope[a]=t[a]));r||i||(s.__scope[a]=t[a]),Object.defineProperty(n,a,{get:function(){return s.__scope[a]}}),Object.defineProperty(e._state.prototype,a,{get:function(){return s.__scope[a]&&s.__scope[a].state},set:function(t){return s._mount(a,t)}}),Object.defineProperty(e._data.prototype,a,{get:function(){return s.__scope[a]&&s.__scope[a].data},set:function(t){return s._mount(a,void 0,t)}})}})}},{key:"bind",value:function(t,e,s){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=void 0,a=void 0,o=void 0;if(e&&!l.array(e)&&(e=[e]),s!==!1&&s!==!0||(i=s,s=null),o=e.map(function(t){return l.string(t)?t:t.name}),this._followers.push([t,e,s||void 0,n=o&&o.reduce(function(t,e){return t[e]=0,t},{})]),this.mount(e),i&&this._stable){if(a=this.getUpdates(n),!a)return;"function"!=typeof t?s?t.setState(r({},s,a)):t.setState(a):t(a)}return this}},{key:"unBind",value:function(t,e,s){for(var i=this._followers,r=i&&i.length;i&&r--;)if(i[r][0]===t&&""+i[r][1]==""+e&&i[r][2]==s)return i.splice(r,1)}},{key:"map",value:function(t,e){var s=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.constructor.Store;if(e=l.array(e)?e:[e],this.mount(e),i&&t instanceof r)r.map(t,e,this,this,!1);else if(i){this.bind(t,e,void 0,!1);var n=void 0,a=t.isReactComponent?"componentWillUnmount":"destroy";t.hasOwnProperty(a)&&(n=t[a]),t[a]=function(){return delete t[a],n&&(t[a]=n),s.unBind(t,e),t[a]&&t[a].apply(t,arguments)}}return e.reduce(function(t,e){return l.string(e)||(e=e.name),e=e.split(":"),e[0]=e[0].split("."),t[e[1]||e[0][e[0].length-1]]=s.stores[e[0][0]]&&s.stores[e[0][0]].retrieve&&s.stores[e[0][0]].retrieve(e[0].splice(1)),t},{})}},{key:"retrieve",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t=l.string(t)?t.split("."):t,t&&this.stores[t[0]]&&this.stores[t[0]].retrieve(t.splice(1))}},{key:"getStoresRevs",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1],s=this.__scope;return t||(t={}),Object.keys(s).forEach(function(e){l.fn(s[e])?t.hasOwnProperty(e)||(t[e]=!1):t[e]=s[e]._rev}),e||(this.__mixed.reduce(function(e,s){return s.getStoresRevs(t),t},t),this.parent&&this.parent.getStoresRevs(t)),t}},{key:"getUpdates",value:function(t,e,s){var i=this,r=this.__scope;return e=e||{},Object.keys(r).forEach(function(n){e[n]||t&&(!t.hasOwnProperty(n)||void 0!==t[n])&&(!t.hasOwnProperty(n)||r[n]._rev<=t[n])||(s=!0,e[n]=i.data[n],t&&void 0!==t[n]&&(t[n]=r[n]._rev))}),s=this.__mixed.reduce(function(s,i){return i.getUpdates(t,e,s)||s},s),s=this.parent&&this.parent.getUpdates(t,e,s)||s,s&&e}},{key:"serialize",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:/.*/,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:/.*/,i=this.__scope,r={state:{},data:{}};return l.array(e)&&e.forEach(function(e){return r.state[e]=t.state[e]}),l.array(s)&&s.forEach(function(e){return r.data[e]=t.data[e]}),l.array(s)||l.array(e)||Object.keys(i).forEach(function(n){if(!l.fn(i[n])){var a=i[n].constructor.flags;a=l.array(a)?a:[a||""],a.reduce(function(t,s){return t||e.test(s)},!1)&&(r.state[n]=t.state[n]),a.reduce(function(t,e){return t||s.test(e)},!1)&&(r.data[n]=t.data[n])}}),r}},{key:"dispatch",value:function(t,e){var s=this;return Object.keys(this.__scope).forEach(function(i){l.fn(s.__scope[i])||s.__scope[i].trigger(t,e)}),this.__mixed.forEach(function(s){return s.dispatch(t,e)}),this.parent&&this.parent.dispatch(t,e),this}},{key:"then",value:function(t){var e=this;return this._stable?t(null,this.data):void this.once("stable",function(s){return t(null,e.data)})}},{key:"restore",value:function(t,e){var s=t.state,i=t.data,r=this.__scope;Object.keys(i).forEach(function(t){e?r.data=i[t]:r.push(i[t])}),Object.keys(s).forEach(function(t){e?r.state=s[t]:r.setState(s[t])})}},{key:"retainStores",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=arguments[1];e.forEach(function(e){return t.stores[e]&&t.stores[e].retain&&t.stores[e].retain(s)})}},{key:"disposeStores",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=arguments[1];e.forEach(function(e){return t.stores[e]&&t.stores[e].dispose&&t.stores[e].dispose(s)})}},{key:"wait",value:function(t){this._stable&&!this.__locks.all&&this.emit("unstable",this),this._stable=!1,this.__locks.all++,t&&(this.__locks[t]=this.__locks[t]||0,this.__locks[t]++)}},{key:"release",value:function(t){var e=this;t&&(0==this.__locks[t],this.__locks[t]=this.__locks[t]||0,this.__locks[t]--),!t&&0==this.__locks.all,this.__locks.all--,this.__locks.all||(this._stabilizerTM&&clearTimeout(this._stabilizerTM),this._stabilizerTM=setTimeout(function(t){e._stabilizerTM=null,e.__locks.all||(e._propagTM&&clearTimeout(e._propagTM),e._stable=!0,e.emit("stable",e),!e.dead&&e._propag())}))}},{key:"propag",value:function(){var t=this;this._propagTM&&clearTimeout(this._propagTM),this._propagTM=setTimeout(function(e){t._propagTM=null,t._propag()},2)}},{key:"_propag",value:function(){var t=this;this._followers.length&&this._followers.forEach(function(e){var s=e[0],n=(e[1],e[2]),a=e[3],o=t.getUpdates(a);o&&("function"!=typeof s?n?s.setState(r({},n,o)):s.setState(o):s(o,a&&[].concat(i(a))||"no revs"))}),this.emit("update",this.getUpdates())}},{key:"isStable",value:function(){return this._stable}},{key:"_addChild",value:function(t){var e=this;this._childScopes.push(t);var s={stable:function(t){e._unStableChilds--,e._unStableChilds||e.emit("stableTree",e)},unstable:function(t){e._unStableChilds++,1==e._unStableChilds&&e.emit("unstableTree",e)},stableTree:function(t){e._unStableChilds--,e._unStableChilds||e.emit("stableTree",e)},unstableTree:function(t){e._unStableChilds++,1==e._unStableChilds&&e.emit("unstableTree",e)},destroy:function(t){t._unStableChilds&&e._unStableChilds--,t.isStable()||e._unStableChilds--,e._unStableChilds||e.emit("stableTree",e)}},i=this._unStableChilds;!t.isStable()&&this._unStableChilds++,t._unStableChilds&&this._unStableChilds++,this._childScopesList.push(s),!i&&this._unStableChilds&&this.emit("unstableTree",this),t.on(s)}},{key:"_rmChild",value:function(t){var e=this._childScopes.indexOf(t),s=this._unStableChilds;e!=-1&&(this._childScopes.splice(e,1),!t.isStable()&&this._unStableChilds--,t._unStableChilds&&this._unStableChilds--,t.un(this._childScopesList.splice(e,1)[0]),s&&!this._unStableChilds&&this.emit("stableTree"))}},{key:"retain",value:function(t){this.__retains.all++,t&&(this.__retains[t]=this.__retains[t]||0,this.__retains[t]++)}},{key:"dispose",value:function(t){var e=this;if(t){if(!this.__retains[t])throw new Error("Dispose more than retaining : "+t);this.__retains[t]--}if(!this.__retains.all)throw new Error("Dispose more than retaining !");this.__retains.all--,this.__retains.all||(this._persistenceTm?(this._destroyTM&&clearTimeout(this._destroyTM),this._destroyTM=setTimeout(function(t){e.then(function(t){!e.__retains.all&&e.destroy()})},this._persistenceTm)):this.then(function(t){return!e.__retains.all&&e.destroy()}))}},{key:"destroy",value:function(){var t=this;for(this.__scope,this.dead=!0,this.emit("destroy",this),Object.keys(this.__listening).forEach(function(e){return t.__scope[e].removeListener(t.__listening[e])}),this._stabilizerTM&&clearTimeout(this._stabilizerTM),this._propagTM&&clearTimeout(this._propagTM),this.__listening={},this._isLocalId&&delete f[this._id],this._followers.length=0;this.__mixedList.length;)this.__mixed[0].removeListener(this.__mixedList.shift()),this.__mixed.shift().dispose("mixedTo");this.__parentList&&(this.parent._rmChild(this),this.parent.removeListener(this.__parentList),this.parent.dispose("isMyParent"),this.__parentList=null),this.__mixed=this.data=this.state=this.scope=this.stores=null,this._data=this._state=this._stores=null}},{key:"datas",get:function(){return this.data}}]),e}(h);p.persistenceTm=1,p.Store=null,p.scopes=f,e.default=p,t.exports=e.default},function(t,e){t.exports=require("shortid")},function(t,e,s){"use strict";function i(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function r(t){if(Array.isArray(t)){for(var e=0,s=Array(t.length);e<t.length;e++)s[e]=t[e];return s}return Array.from(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t},l=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}(),h=function t(e,s,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,s);if(void 0===r){var n=Object.getPrototypeOf(e);return null===n?void 0:t(n,s,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},c=s(1),_=s(3),f=s(2),p=s(4),d=Object.getPrototypeOf({}),v=function(t){function e(){var t,s;n(this,e);var i,o=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),l=[].concat(Array.prototype.slice.call(arguments)),h=o.constructor,f=l[0]instanceof _?l.shift():h.scope?_.getScope(h.scope):c.string(l[0])?_.getScope(l.shift()):h.staticScope,d=!l[0]||c.array(l[0])||c.string(l[0])?{}:l.shift(),v=c.string(l[0])?l[0]:d.name||h.name,y=c.array(l[0])?l.shift():d.use||[],b=c.fn(l[0])?l.shift():d.apply||null,m=h.state||h.initialState;return o._uid=d._uid||p.generate(),o.__retains={all:0},o.__locks={all:0},o._onStabilize=[],o._persistenceTm=d.persistenceTm||o.constructor.persistenceTm,c.string(l[0])&&(f.__scope[v],f.__scope[v]=o),d&&d.on&&o.on(d.on),o.name=v,f.stores?(o.scopeObj=f,o.scope=f.stores):(o.scopeObj=new _(f),o.scope=f.stores),o._rev=o.constructor._rev||0,o._revs={},o.stores={},o._require=[],c.array(h.use)?o._use=[].concat(r(y),r((h.use||[]).map(function(t){var e=t.match(/^(\!?)([^\:]*)(?:\:(.*))?$/);if(e[1]){var s=e[2].split(".");o._require.push(e[3]||s[s.length-1])}return e[2]}))):o._use=[].concat(r(y),r(h.use?Object.keys(h.use).map(function(t){var e=t.match(/^(\!?)(.*)$/);return e[1]&&o._require.push(h.use[t]),e[2]+(h.use[t]===!0?"":":"+h.use[t])}):[])),h.require&&(t=o._require).push.apply(t,r(h.require)),d.require&&(s=o._require).push.apply(s,r(d.require)),o._followers=[],void 0!==h.data&&(o.data=u({},h.data)),d.hasOwnProperty("data")&&void 0!==d.data&&(o.data=d.data),d.hasOwnProperty("state")&&void 0!==d.state&&(m=u({},m,d.state)),b&&(o.apply=b),(m||o._use.length)&&(o.state=u({},m||{},f.map(o,o._use)),o.shouldApply(o.state)&&void 0===o.data&&(o.data=o.apply(o.data,o.state,o.state),i=!0)),void 0===o.data&&!i||o.__locks.all?(o._stable=!1,!(h.managed||o.state||o._use&&o._use.length)):(o._stable=!0,o._rev++),!o._stable&&o.emit("unstable",o.state),o}return o(e,t),l(e,[{key:"shouldPropag",value:function(t){var e,s=(this.constructor,this.data);return e=!s&&t,s&&Object.keys(s).forEach(function(i){e=e||(t?s[i]!==t[i]:s&&s[i])}),t&&Object.keys(t).forEach(function(i){e=e||(t?s[i]!==t[i]:s&&s[i])}),!!e}},{key:"shouldApply",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state,s=this.constructor;return!!this.isComplete(e)&&(c.array(s.follow)?s.follow.reduce(function(t,s){return t||e&&e[s]},!1):!s.follow||Object.keys(s.follow).reduce(function(i,r){return i||e&&c.fn(s.follow[r])&&s.follow[r].call(t,e[r])||s.follow[r]&&e[r]!==t.state[r]},!1))}},{key:"apply",value:function(t,e,s){return e=e||this.state,this.refine?this.refine.apply(this,arguments):t&&t.__proto__===d&&e.__proto__===d?u({},t,e):e}},{key:"refine",value:function(t,e,s){return e=e||this.state,t&&t.__proto__===d&&e.__proto__===d?u({},t,e):e}},{key:"stabilize",value:function(t){var e=this;t&&this.once("stable",t),this._stable&&this.emit("unstable",this.state,this.data),this._stable=!1,this._stabilizer&&clearTimeout(this._stabilizer),this._stabilizer=setTimeout(this.push.bind(this,null,function(){var t=e._stable;e._stable=!0,!t&&e.emit("stable",e.state,e.data),e._stabilizer=null}))}},{key:"retrieve",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.data;return t=c.string(t)?t.split("."):t,s&&t&&t.length?t.length==e+1?s[t[e]]:this.retrieve(t,e+1,s[t[e]]):s}},{key:"dispatch",value:function(t){for(var e,s=arguments.length,i=Array(s>1?s-1:0),r=1;r<s;r++)i[r-1]=arguments[r];(e=this.scopeObj).dispatch.apply(e,[t].concat(i))}},{key:"trigger",value:function(t){var e=this.constructor.actions,s=void 0;if(e&&e[t]){for(var i,r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];s=(i=e[t]).call.apply(i,[this].concat(n)),s&&this.setState(s)}}},{key:"pull",value:function(t,e,s){var i=this,r=this.scopeObj.map(this,t);return e&&(this.wait(),t.forEach(function(t){return i.scope[t]&&i.wait(i.scope[t])}),this.release()),r}},{key:"push",value:function(t,e,s){s=e===!0?s:e,e=e===!0;var i=!t&&u({},this.state,this._changesSW)||this.state,r=t||this.apply(this.data,i,this._changesSW);return this.state=i,e||(this.data||this.data!==r)&&this.shouldPropag(r)?(this.data=r,this._changesSW={},this.wait(),void this.release(s)):(s&&s(),!1)}},{key:"setState",value:function(t,e,s){var i,r=this._changesSW=this._changesSW||{};for(var n in t)(!this.state||t.hasOwnProperty(n)&&(t[n]!=this.state[n]||this.state[n]&&t[n]&&t[n]._rev!=this._revs[n]))&&(i=!0,this._revs[n]=t[n]&&t[n]._rev||!0,r[n]=t[n]);if(this.shouldApply(u({},this.state,r)))return s?(this.push(),e&&e()):i?this.stabilize(e):e&&e(),this}},{key:"setStateSync",value:function(t){var e,s=this._changesSW=this._changesSW||{};for(var i in t)(!this.state||t.hasOwnProperty(i)&&(t[i]!=this.state[i]||this.state[i]&&t[i]&&t[i]._rev!=this._revs[i]))&&(e=!0,this._revs[i]=t[i]&&t[i]._rev||!0,s[i]=t[i]);return this.shouldApply(u({},this.state||{},s))&&this.push(),this.data}},{key:"replaceState",value:function(t,e){this.state=t,this.stabilize(e)}},{key:"as",value:function(t){return{store:this,name:t}}},{key:"on",value:function(t){var s=this;!c.string(t)&&t?Object.keys(t).forEach(function(i){return h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"on",s).call(s,i,t[i])}):h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"on",this).apply(this,arguments)}},{key:"removeListener",value:function(t){var s=this;!c.string(t)&&t?Object.keys(t).forEach(function(i){return h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removeListener",s).call(s,i,t[i])}):h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removeListener",this).apply(this,arguments)}},{key:"relink",value:function(t){var e=this,s=this.scopeObj,i=this.constructor;i.use&&this.pull(i.use,!1,t),this._require&&this._require.forEach(function(t){return e.wait(s.__scope[t])})}},{key:"isComplete",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state;return this.constructor,!this._require||!this._require.length||t&&this._require.reduce(function(e,s){return e&&t[s]},!0)}},{key:"isStable",value:function(){return this._stable}},{key:"unBind",value:function(t,e,s){for(var i=this._followers,r=i&&i.length;i&&r--;)if(i[r][0]===t&&i[r][1]===e&&i[r][2]===s)return i.splice(r,1)}},{key:"bind",value:function(t,e){var s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments[3];if(this._followers.push([t,e,r]),s&&this.data&&this._stable){var n=r?this.retrieve(r):this.data;"function"!=typeof t?e?t.setState(i({},e,n)):t.setState(n):t(n)}}},{key:"then",value:function(t){var e=this;return this._stable?t(null,this.data):void this.once("stable",function(s){return t(null,e.data)})}},{key:"wait",value:function(t){if("number"==typeof t)return this.__locks.all+=t;if(c.array(t))return t.map(this.wait.bind(this));this._stable&&this.emit("unstable",this.state,this.data),this._stable=!1,this.__locks.all++;var e=c.string(t)?t:null;return e&&(this.__locks[e]=this.__locks[e]||0,this.__locks[e]++),t&&c.fn(t.then)&&t.then(this.release.bind(this,null)),this}},{key:"release",value:function(t,e){var s=this,r=(this.constructor,this._stable);return c.fn(t)&&(e=t,t=null),t&&(0==this.__locks[t],this.__locks[t]=this.__locks[t]||0,this.__locks[t]--),!t&&0==this.__locks.all,!--this.__locks.all&&this.data&&this.isComplete()?(this._stable=!0,this._rev++,this._followers.length&&this._followers.forEach(function(t){var e=t[2]?s.retrieve(t[2]):s.data;e&&("function"==typeof t[0]?t[0](e):t[0].setState(t[1]?i({},t[1],e):e))}),!r&&this.emit("stable",this.data),this.emit("update",this.data),e&&e()):e&&this.then(e),this}},{key:"retain",value:function(t){this.__retains.all++,t&&(this.__retains[t]=this.__retains[t]||0,this.__retains[t]++)}},{key:"dispose",value:function(t){var e=this;if(t){if(!this.__retains[t])throw new Error("Dispose more than retaining : "+t);this.__retains[t]--}if(0==this.__retains.all)throw new Error("Dispose more than retaining !");this.__retains.all--,this.__retains.all||(this._persistenceTm?(this._destroyTM&&clearTimeout(this._destroyTM),this._destroyTM=setTimeout(function(t){e._destroyTM=null,e.then(function(t){!e.__retains.all&&e.destroy()})},this._persistenceTm)):this.then(function(t){return!e.__retains.all&&e.destroy()}))}},{key:"destroy",value:function(){this.emit("destroy",this),this._stabilizer&&clearTimeout(this._stabilizer),this._followers.length&&this._followers.forEach(function(t){"function"!=typeof t[0]&&t[0].stores&&delete t[0].stores[t[1]]}),this._followers.length=0,this.constructor._rev=this.rev,this.dead=!0,this._revs=this.data=this.state=this.scope=null,this.removeAllListeners()}},{key:"datas",get:function(){return this.data},set:function(t){this.data=t}}],[{key:"as",value:function(t){return{store:this,name:t}}},{key:"map",value:function(t,s,i,n){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=t._revs||{},u=t.stores||(t.stores={}),l={};s=c.array(s)?[].concat(r(s)):[s],i=i||e.staticScope,s=s.filter(function(e){if(!e)return!1;var s=void 0,r=void 0,n=void 0,h=void 0;return e.store&&e.name?(r=s=e.name,h=e.store):c.fn(e)?(s=r=e.name||e.defaultName,h=e):(e=e.match(/([\w_]+)((?:\.[\w_]+)*)(?:\:([\w_]+))?/),s=e[1],n=e[2]&&e[2].split(".").slice(1),h=i.stores[e[1]],r=e[3]||n&&n[n.length-1]||e[1]),!o[s]&&!!h&&(c.fn(h)?(i._mount(s),i.stores[s].bind(t,r,a,n)):h.bind(t,r,a,n),o[r]=o[r]||!0,!u[s]&&(u[s]=i.stores[s]),i.stores[s].hasOwnProperty("data")&&(l[s]=i.data[s]),!0)});var h,_=t.isReactComponent?"componentWillUnmount":"destroy";return t.hasOwnProperty(_)&&(h=t[_]),t[_]=function(){return delete t[_],h&&(t[_]=h),s.map(function(e){var s=void 0,r=void 0,n=void 0,a=void 0;e.store&&e.name?(r=s=e.name,a=e.store):c.fn(e)?(s=r=e.name||e.defaultName,a=i.stores[s]):(e=e.match(/([\w_]+)((?:\.[\w_]+)*)(?:\:([\w_]+))?/),s=e[1],n=e[2]&&e[2].split("."),a=i.stores[e[1]],r=e[3]||n&&n[n.length-1]||e[1]),a&&!c.fn(a)&&a.unBind(t,r,n)}),t[_]&&t[_].apply(t,arguments)},l}}]),e}(f);v.use=[],v.staticScope=new _({},{id:"static"}),v.state=void 0,v.persistenceTm=!1,e.default=v,t.exports=e.default}]);
//# sourceMappingURL=Rescope.nodeps.min.js.map